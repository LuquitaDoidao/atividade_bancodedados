/* 1 */
UPDATE debitos d
SET d. SITUACAO_DEBITO = 'Atrasado'
WHERE (current_date) > (d. datavencimento) AND (d. SITUACAO_DEBITO <> 'Negociado') AND (d. SITUACAO_DEBITO <> 'Pago');

/* 2 */
UPDATE debitos d
SET SITUACAO_DEBITO = 'Pendente'
WHERE (current_date) <= (d. datavencimento) AND (d. SITUACAO_DEBITO <> 'Pago'); 

/* 3 */
UPDATE debitos d
SET d. DATAVENCIMENTO = dateadd(YEAR, -5, d. DATAVENCIMENTO)
WHERE d. SITUACAO_DEBITO = 'Negociado'; 

/* 4 */
SELECT p. nome, p. email, p.telefone
FROM pessoa p

/* 5 */
SELECT p. preco_unitario
FROM produto p
WHERE p. PRECO_UNITARIO > 100

/* 6 */
SELECT v. *
FROM venda v
WHERE v. DATA_VENDA = '2022-10-29'

/* 7 */
SELECT p. nome, p. data_nascimento, (EXTRACT(YEAR FROM current_date) - extract(YEAR FROM p.data_nascimento))
FROM pessoa p
WHERE p. id_pessoa = (SELECT f. ID_PESSOA FROM fornecedor f WHERE f.ID_fornecedor = (SELECT p. id_fornecedor FROM produto p WHERE p. quantidade_estoque IS null))

/* 8 */
SELECT DISTINCT c. id_cliente, p. nome, c. cpf
FROM cliente c
LEFT JOIN pessoa p ON p. id_pessoa = c. id_pessoa
LEFT JOIN debitos d ON d. id_cliente = c.ID_CLIENTE 
WHERE d. situacao_debito <> 'Pago' AND d. datavencimento < CURRENT_DATE

/* 10 VER COM A LAIS PQ TA TUDO ERRADO*/
SELECT DISTINCT c. id_cliente, p. nome, (EXTRACT(YEAR FROM current_date) - extract(YEAR FROM p.data_nascimento)), SUM(D. VALOR_TOTAL)
FROM cliente c
LEFT JOIN pessoa p ON p. id_pessoa = c. id_pessoa
LEFT JOIN DEBITOS D ON D. ID_CLIENTE = C.ID_CLIENTE

/* 11 */
UPDATE PRODUTO P
SET P. PRECO_UNITARIO = P. PRECO_UNITARIO * 1.10
WHERE P. PRECO_UNITARIO < 10

/* 13 */
UPDATE debitos d
SET d. SITUACAO_DEBITO = 'Pago'
WHERE d. SITUACAO_DEBITO = 'Atrasado' and d. id_debito in (SELECT p. id_debito FROM pagamento p)

/* 15 */
SELECT v. data_venda
FROM venda v
WHERE v. DATA_VENDA > '2023-12-30' AND v. DATA_VENDA < '2024-01-01'

/* 16 */
SELECT p. quantidade_ESTOQUE
FROM PRODUTO P
WHERE p. quantidade_ESTOQUE > 5 AND p. quantidade_ESTOQUE < 20

/* 17 */
SELECT p. NOME
FROM PESSOA P
WHERE P. NOME LIKE 'A%'

/* 18 */
SELECT P. NOME
FROM PRODUTO P
WHERE P. ID_PRODUTO NOT IN (SELECT I. ID_PRODUTO FROM ITENSVENDA i)

/* 19 VER COM A LAIS (EU COPIEI DO DIMITRI E O RESULTADO ESTÁ DIFERENTE DO DELE)*/
SELECT P. NOME, PR. NOME
FROM CLIENTE C
LEFT JOIN PESSOA P ON C. ID_PESSOA = P. ID_PESSOA 
LEFT JOIN VENDA V ON V. ID_PESSOA = C. ID_PESSOA
LEFT JOIN ITENSVENDA I ON I. ID_VENDA = V. ID_VENDA
LEFT JOIN PRODUTO PR ON I. ID_PRODUTO = PR. ID_PRODUTO
WHERE P. NOME IN ('Carla Souza', 'Larissa Ferreira')

/* 20 */
SELECT P. NOME
FROM PESSOA P
WHERE P. ID_PESSOA NOT IN (SELECT C. ID_PESSOA FROM CLIENTE c) AND P. ID_PESSOA NOT IN (SELECT F. ID_PESSOA FROM FORNECEDOR F)

/* 21 */
SELECT V. *, C. *, F. DESCRICAO
FROM VENDA V
INNER JOIN CLIENTE C ON C. ID_CLIENTE = V. ID_PESSOA
INNER JOIN PESSOA P ON P. ID_PESSOA = C. ID_CLIENTE 
INNER JOIN FORMA_PAGAMENTO f ON F. ID_FORMA_PAGAMENTO = V. ID_FORMA_PAGAMENTO

/* 22 */
SELECT V. *, C. *, F. DESCRICAO
FROM VENDA V
INNER JOIN CLIENTE C ON C. ID_CLIENTE = V. ID_PESSOA
INNER JOIN PESSOA P ON P. ID_PESSOA = C. ID_CLIENTE 
INNER JOIN FORMA_PAGAMENTO f ON F. ID_FORMA_PAGAMENTO = V. ID_FORMA_PAGAMENTO

/* 23 TENHO QUE TERMINAR*/
SELECT P. NOME, P. NOME, (EXTRACT(YEAR FROM '2025-01-01') - extract(YEAR FROM p.data_nascimento))
FROM PESSOA P

/* 24 LAIS, DESSA PARA FRENTE EU TIVE A AJUDA DO OTHAVIO :) */
SELECT P.NOME,L.NOME,B.NOME
FROM PESSOA p
RIGHT JOIN ENDERECO E ON E.ID_PESSOA = P.ID_PESSOA
RIGHT JOIN LOGRADOURO L ON L.ID_LOGRADOURO = E.ID_LOGRADOURO 
RIGHT JOIN BAIRRO b ON B.ID_BAIRRO = E.ID_BAIRRO 

/* 25 */
SELECT P. NOME, P. PRECO_UNITARIO 
FROM PRODUTO P
WHERE P. PRECO_UNITARIO > (SELECT AVG(p2.PRECO_UNITARIO) FROM PRODUTO p2 )

/* 26 */
SELECT p. nome
FROM PESSOA P
WHERE P.ID_PESSOA IN (SELECT E.ID_PESSOA FROM ENDERECO E WHERE E.ID_MUNICIPIO IN (SELECT M.ID_MUNICIPIO FROM MUNICIPIO M WHERE m. populacao > 1000000))

/* 27 */
SELECT COUNT(CASE WHEN P.ID_PRODUTO IN (SELECT I.ID_PRODUTO FROM ITENSVENDA I) THEN 1 END),F.ID_FORNECEDOR
FROM FORNECEDOR F
LEFT JOIN PRODUTO P ON P.ID_FORNECEDOR = F.ID_FORNECEDOR
GROUP BY F.ID_FORNECEDOR

/* 28 */
SELECT P.NOME, V.VALOR_TOTAL
FROM VENDA V
RIGHT JOIN PESSOA P ON P.ID_PESSOA = V.ID_PESSOA
WHERE V.VALOR_TOTAL > 500

/* 29 */
SELECT P.NOME, E.NUMERO, E.COMPLEMENTO, L.NOME, B.NOME, B.CEP
FROM PESSOA P
RIGHT JOIN ENDERECO E ON E.ID_PESSOA = P.ID_PESSOA
RIGHT JOIN LOGRADOURO L ON L.ID_LOGRADOURO = E.ID_LOGRADOURO
RIGHT JOIN BAIRRO B ON B.ID_BAIRRO = L.ID_BAIRRO
WHERE E.NUMERO IS NOT NULL

/* 30 */
SELECT PES.NOME AS FORNECEDOR, P.NOME AS PRODUTO, P.DESCRICAO, P.PRECO_UNITARIO, P.QUANTIDADE_ESTOQUE
FROM PRODUTO P
INNER JOIN FORNECEDOR F ON F.ID_FORNECEDOR = P.ID_FORNECEDOR
RIGHT JOIN PESSOA PES ON PES.ID_PESSOA = F.ID_PESSOA
WHERE PES.ID_PESSOA IN (SELECT F.ID_PESSOA FROM FORNECEDOR F)

/* 31 */
SELECT * FROM PRODUTO P
ORDER BY P.QUANTIDADE_ESTOQUE DESC

/* 32 */
SELECT * FROM VENDA V
ORDER BY V.VALOR_TOTAL ASC

/* 33 */
SELECT * FROM PRODUTO P
WHERE P.QUANTIDADE_ESTOQUE < (SELECT AVG(P.QUANTIDADE_ESTOQUE) FROM PRODUTO P)

/* 34 */
SELECT P.TELEFONE, P.NOME, P.EMAIL
FROM PESSOA P
WHERE P.TELEFONE IN (SELECT TELEFONE FROM PESSOA P GROUP BY P.TELEFONE HAVING COUNT(*) > 1)

/* 35 */
UPDATE PRODUTO P
SET P.PRECO_UNITARIO = P.PRECO_UNITARIO *1.1
WHERE P.ID_FORNECEDOR IN (SELECT F.ID_FORNECEDOR FROM FORNECEDOR F WHERE F.ID_PESSOA IN (SELECT P2.ID_PESSOA FROM PESSOA P2 WHERE P2.ID_PESSOA IN (SELECT E.ID_PESSOA FROM ENDERECO E WHERE E.ID_MUNICIPIO IN (SELECT M.ID_MUNICIPIO FROM MUNICIPIO M WHERE M.NOME = 'São Paulo'))))

/* 36 */
SELECT * FROM VENDA V
WHERE V.ID_VENDA IN (SELECT D.ID_VENDA FROM DEBITOS D WHERE D.SITUACAO_DEBITO = 'Negociado')
